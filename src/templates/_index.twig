{% extends '_layouts/cp' %}
{% import '_includes/forms' as forms %}

{% block actionButton %}
    <div class="buttons">
        <div class="btngroup">
            <button type="button" class="btn submit" data-icon="refresh">
                {{ 'Check All Services'|t('site-monitor') }}
            </button>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div id="site-monitor-dashboard">
        {% if not settings.enabled %}
            {% include "_includes/forms/warning" with {
                message: "Monitoring is currently disabled. Enable it in plugin settings."|t('site-monitor')
            } %}
        {% endif %}

        {# System Status Overview #}
        <div class="monitoring-overview">
            <div class="pane">
                <div class="monitoring-stats">
                    <div class="stat">
                        <div class="stat-label">{{ 'Overall Health'|t('site-monitor') }}</div>
                        <div class="stat-value status-healthy">98.5%</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">{{ 'Active Monitors'|t('site-monitor') }}</div>
                        <div class="stat-value">12</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">{{ 'Incidents'|t('site-monitor') }}</div>
                        <div class="stat-value status-warning">2</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">{{ 'Response Time'|t('site-monitor') }}</div>
                        <div class="stat-value">245ms</div>
                    </div>
                </div>
            </div>
        </div>

        {# Active Incidents #}
        <div class="monitoring-incidents">
            <h2>{{ 'Active Incidents'|t('site-monitor') }}</h2>
            <div class="incident-list">
                {% set incidents = [
                    {
                        status: 'critical',
                        title: 'High CPU Usage',
                        message: 'Server CPU usage above 90%',
                        time: '10 minutes ago'
                    },
                    {
                        status: 'warning',
                        title: 'Elevated Response Time',
                        message: 'API response time exceeding threshold',
                        time: '25 minutes ago'
                    }
                ] %}

                {% for incident in incidents %}
                    <div class="pane incident-item status-{{ incident.status }}">
                        <div class="incident-header">
                            <div class="incident-status"></div>
                            <div class="incident-title">{{ incident.title }}</div>
                            <div class="incident-time light">{{ incident.time }}</div>
                        </div>
                        <div class="incident-body">
                            {{ incident.message }}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        {# Service Status #}
        <div class="monitoring-services">
            <h2>{{ 'Service Status'|t('site-monitor') }}</h2>
            <table class="data fullwidth">
                <thead>
                    <tr>
                        <th>{{ 'Service'|t('site-monitor') }}</th>
                        <th>{{ 'Status'|t('site-monitor') }}</th>
                        <th>{{ 'Uptime'|t('site-monitor') }}</th>
                        <th>{{ 'Response Time'|t('site-monitor') }}</th>
                        <th>{{ 'Last Check'|t('site-monitor') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% set services = [
                        {
                            name: 'Website Frontend',
                            status: 'healthy',
                            uptime: '99.99%',
                            response: '150ms',
                            lastCheck: '1 minute ago'
                        },
                        {
                            name: 'API Endpoint',
                            status: 'warning',
                            uptime: '98.5%',
                            response: '450ms',
                            lastCheck: '2 minutes ago'
                        },
                        {
                            name: 'Database',
                            status: 'healthy',
                            uptime: '100%',
                            response: '50ms',
                            lastCheck: '1 minute ago'
                        },
                        {
                            name: 'Cache Server',
                            status: 'healthy',
                            uptime: '99.95%',
                            response: '25ms',
                            lastCheck: '1 minute ago'
                        }
                    ] %}

                    {% for service in services %}
                        <tr>
                            <td>
                                <div class="service-name">{{ service.name }}</div>
                            </td>
                            <td>
                                <span class="status-badge status-{{ service.status }}">
                                    {{ service.status|title }}
                                </span>
                            </td>
                            <td>{{ service.uptime }}</td>
                            <td>{{ service.response }}</td>
                            <td class="light">{{ service.lastCheck }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {# Recent Activity #}
        <div class="monitoring-activity">
            <h2>{{ 'Recent Activity'|t('site-monitor') }}</h2>
            <table class="data fullwidth">
                <tbody>
                    {% set activities = [
                        {
                            type: 'recovery',
                            message: 'API Service recovered',
                            time: '10 minutes ago'
                        },
                        {
                            type: 'alert',
                            message: 'High CPU usage detected',
                            time: '25 minutes ago'
                        },
                        {
                            type: 'info',
                            message: 'Scheduled maintenance completed',
                            time: '1 hour ago'
                        }
                    ] %}

                    {% for activity in activities %}
                        <tr>
                            <td>
                                <span class="activity-icon activity-{{ activity.type }}"></span>
                            </td>
                            <td>{{ activity.message }}</td>
                            <td class="light">{{ activity.time }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

{% endblock %}
