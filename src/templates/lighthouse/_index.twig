{% extends '_layouts/cp' %}
{% import '_includes/forms' as forms %}

{% set title = "Lighthouse Scores"|t('site-monitor') %}
{% do view.registerAssetBundle("appfoster\\sitemonitor\\assetbundles\\monitor\\LighthouseAsset") %}


{% block actionButton %}
	<div class="buttons">
		<div class="btngroup">
			<button type="button" class="btn submit" data-icon="refresh" id="refresh-btn">
				{{ 'Refresh'|t('site-monitor') }}
			</button>
		</div>
	</div>
{% endblock %}


{% block content %}
	<!-- Device Selector -->
	<div class="device-selector">
		<div class="device-tabs">
			<button class="device-tab active" data-device="desktop">
				<svg class="device-icon" viewbox="0 0 24 24" fill="currentColor">
					<path d="M21,16H3V4H21M21,2H3C1.89,2 1,2.89 1,4V16A2,2 0 0,0 3,18H10V20H8V22H16V20H14V18H21A2,2 0 0,0 23,16V4C23,2.89 22.1,2 21,2Z"/>
				</svg>
				{{ 'Desktop'|t('site-monitor') }}
			</button>
			<button class="device-tab" data-device="mobile">
				<svg class="device-icon" viewbox="0 0 24 24" fill="currentColor">
					<path d="M17,19H7V5H17M17,1H7C5.89,1 5,1.89 5,3V21A2,2 0 0,0 7,23H17A2,2 0 0,0 19,21V3C19,1.89 18.1,1 17,1Z"/>
				</svg>
				{{ 'Mobile'|t('site-monitor') }}
			</button>
		</div>
	</div>

	<!-- Info Panel -->
	<div class="info-panel">
		<div class="info-grid">
			<div class="info-item">
				<span class="info-label">{{ 'Tested URL'|t('site-monitor') }}</span>
				<span class="info-value">{{ data.url|default('–') }}</span>
			</div>
			<div class="info-item">
				<span class="info-label">{{ 'Last Checked'|t('site-monitor') }}</span>
				<span class="info-value">{{ data.checkedAt|date("M j, Y H:i")|default('–') }}</span>
			</div>
			<div class="info-item">
				<span class="info-label">{{ 'Test Duration'|t('site-monitor') }}</span>
				<span class="info-value">{{ data.result.durationMs ? (data.result.durationMs ~ ' ms') : '–' }}</span>
			</div>
			<div class="info-item">
				<span class="info-label">{{ 'Overall Status'|t('site-monitor') }}</span>
				<span class="info-value">{{ data.result.summary.ok ? 'Passed'|t('site-monitor') : 'Issues Found'|t('site-monitor') }}</span>
			</div>
		</div>
	</div>

	<div id="lighthouse-data" style="display: none;">
		{{ data|json_encode|raw }}
	</div>

	<!-- Scores Overview -->
	<div
		class="scores-overview" id="scores-container"><!-- Scores will be populated by JavaScript -->
	</div>

	<!-- Performance Metrics -->
	<div
		class="performance-section" id="performance-container"><!-- Performance metrics will be populated by JavaScript -->
	</div>

	<!-- Loading Overlay -->
	<div class="loading-overlay" id="loading-overlay">
		<div class="loading-spinner"></div>
	</div>
{% endblock %}
